<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Свадебное приглашение — Юлия & Максим</title>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f8f5f1;
      --paper:#ffffff;
      --ink:#333333;
      --accent:#c9a95c;
      --rose:#fff3f3;
      --shadow:0 10px 30px rgba(0,0,0,.08);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      font-family:'Montserrat',sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg),#fff);
    }
    a{text-decoration:none;color:inherit}
    section{padding:100px 8%;position:relative}
    h1,h2{font-family:'Cormorant Garamond',serif;color:var(--accent)}
    h1{font-size:clamp(2.5rem,6vw,4.5rem);letter-spacing:.02em}
    h2{font-size:clamp(1.8rem,4vw,2.6rem);margin-bottom:18px}
    p{font-size:1.08rem;line-height:1.8}

    /* Навигация */
    .nav{
      position:fixed;top:0;left:0;right:0;z-index:1000;
      backdrop-filter:saturate(140%) blur(8px);
      background:rgba(255,255,255,.6);
      border-bottom:1px solid rgba(201,169,92,.2);
    }
    .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:14px 8%}
    .brand{font-family:'Cormorant Garamond',serif;color:var(--accent);font-size:1.3rem;letter-spacing:.06em}
    .links a{margin-left:18px;font-size:.95rem;opacity:.85}
    .links a:hover{opacity:1;color:var(--accent)}
    .burger{display:none;gap:6px;flex-direction:column;justify-content:center;align-items:center;width:42px;height:42px;border:1px solid rgba(201,169,92,.5);border-radius:10px;background:rgba(255,255,255,.7);cursor:pointer}
    .burger span{width:22px;height:2px;background:var(--accent);display:block;transition:.3s}
    .nav.open .burger span:nth-child(2){opacity:0}
    .nav.open .burger span:nth-child(1){transform:translateY(6px) rotate(45deg)}
    .nav.open .burger span:nth-child(3){transform:translateY(-6px) rotate(-45deg)}

    /* Герой */
    .hero{height:100vh;display:grid;place-items:center;overflow:hidden}
    .hero-bg{
      position:absolute;inset:0;z-index:-1;
      background:url('https://images.unsplash.com/photo-1522673607200-164d1b6ce486?q=80&w=1800&auto=format&fit=crop') center/cover no-repeat fixed;
      transform:translateZ(0);
    }
    .hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.25))}
    .hero-card{
      max-width:820px;padding:48px 36px;text-align:center;border-radius:18px;
      background:rgba(255,255,255,.82);box-shadow:var(--shadow);backdrop-filter:blur(6px);
      animation:floatIn 1.2s ease both .1s
    }
    .hero-card p{margin-top:10px}
    .btn{display:inline-block;margin-top:22px;padding:14px 26px;border:2px solid var(--accent);color:var(--accent);transition:.3s;border-radius:999px}
    .btn:hover{background:var(--accent);color:#fff}

    @keyframes floatIn{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:none}}

    /* Обёртки секций */
    .card{background:var(--paper);border-radius:16px;box-shadow:var(--shadow);padding:40px 28px;max-width:980px;margin:0 auto}
    .alt{background:var(--rose)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:28px}

    /* Таймлайн */
    .timeline{position:relative;margin-top:8px}
    .timeline::before{content:'';position:absolute;left:28px;top:0;bottom:0;width:2px;background:var(--accent);opacity:.5}
    .item{position:relative;padding-left:84px;margin:22px 0}
    .dot{position:absolute;left:21px;top:50%;transform:translateY(-50%);width:24px;height:24px;border-radius:50%;background:var(--accent)}
    .time{font-weight:600;color:var(--accent)}

    /* Календарь (минимализм — только цифры) */
    .calendar{background:transparent;border:none;border-radius:0;box-shadow:none;padding:6px 8px;max-width:420px;width:100%;margin:0 auto}
    .cal-header{display:flex;align-items:baseline;justify-content:center;margin-bottom:6px}
    .cal-title{font-family:'Cormorant Garamond',serif;color:var(--accent);font-size:1.3rem}
    .cal-week{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:4px;font-weight:600;opacity:.6}
    .cal-week span{display:grid;place-items:center;padding:2px 0;font-size:.9rem}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .day{position:relative;background:transparent;border:none;border-radius:0;aspect-ratio:1/1;display:grid;place-items:center;min-height:auto}
    .day.muted{opacity:.3}
    .day .num{position:relative;z-index:1;font-weight:600;font-size:1.05rem}
    .day.heart .num{color:var(--accent)}
    .day.heart::after{content:'';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:48px;height:48px;background:no-repeat center/contain url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M24 42s-12-7.3-12-18c0-3.9 3.1-7 7-7 2.9 0 5.2 1.7 7 4 1.8-2.3 4.1-4 7-4 3.9 0 7 3.1 7 7 0 10.7-12 18-12 18z" fill="none" stroke="%23c9a95c" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/></svg>')}

    /* Анимации появления */
    .reveal{opacity:0;transform:translateY(24px);transition:opacity .9s ease,transform .9s ease}
    .reveal.show{opacity:1;transform:none}

    /* Конфетти */
    .confetti{position:fixed;top:-10px;left:0;right:0;pointer-events:none;user-select:none;color:var(--accent);font-size:18px;animation:fall linear forwards}
    @keyframes fall{to{transform:translateY(110vh) rotate(360deg)}}

    /* Форма RSVP */
    form{max-width:560px;margin:10px auto 0}
    label{display:block;margin:8px 0 8px;font-weight:600}
    input,select,button{width:100%;padding:12px 14px;border:1px solid rgba(201,169,92,.6);border-radius:10px;font-family:'Montserrat',sans-serif}
    button{background:var(--accent);color:#fff;border:none;cursor:pointer;margin-top:6px}
    button:disabled{opacity:.6;cursor:not-allowed}
    .note{font-size:.95rem;opacity:.8;margin-top:6px}

    /* Палитра дресс-кода */
    .palette{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;align-items:center;margin-top:12px}
    .swatch{width:46px;height:46px;border-radius:50%;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06)}
    .swatch.center{transform:scale(1.18);border:2px solid rgba(201,169,92,.55)}
    .forbidden{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:10px}
    .swatch.-forbidden{position:relative;box-shadow:none;border:1px dashed rgba(0,0,0,.2)}
    .swatch.-forbidden::after{content:'';position:absolute;left:6px;right:6px;top:50%;height:2px;background:#c44;transform:rotate(-20deg)}
    .subhead{font-family:'Cormorant Garamond',serif;font-size:1.2rem;color:var(--accent);margin-top:6px;margin-bottom:6px;letter-spacing:.03em}
    .dress-sep{height:1px;background:linear-gradient(90deg,rgba(201,169,92,.0),rgba(201,169,92,.35),rgba(201,169,92,.0));margin:16px auto;width:86%}
    .dress-block{max-width:780px;margin:0 auto;text-align:center}

    /* Футер */
    footer{padding:26px 8%;text-align:center;opacity:.8}

    @media(max-width:820px){
      .grid{grid-template-columns:1fr}
      section{padding:80px 6%}
      .links{position:absolute;top:58px;left:0;right:0;display:none;flex-direction:column;gap:0;background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-bottom:1px solid rgba(201,169,92,.25)}
      .links a{margin:0;padding:14px 8%;border-top:1px solid rgba(201,169,92,.15)}
      .nav.open .links{display:flex}
      .burger{display:flex}
    }

    /* Слайдер локации */
    .slider{position:relative;border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
    .slides{display:flex;transition:transform .6s ease}
    .slide{min-width:100%;user-select:none}
    .slide img{display:block;width:100%;height:auto}
    .dots{position:absolute;left:0;right:0;bottom:10px;display:none;gap:6px;justify-content:center}
    .dot{width:16px;height:16px;border-radius:50%;background:rgba(255,255,255,.6);border:1px solid rgba(0,0,0,.1)}
    .dot.active{background:var(--accent)}

    /* Лайтбокс */
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:2000}
    .lightbox.open{display:flex}
    .lightbox img{max-width:90vw;max-height:90vh;border-radius:10px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .lb-close{position:absolute;top:18px;right:18px;background:rgba(255,255,255,.9);border:none;border-radius:999px;width:40px;height:40px;cursor:pointer;font-size:20px}
    .lb-arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.9);border:none;border-radius:999px;width:44px;height:44px;cursor:pointer;font-size:20px}
    .lb-prev{left:16px}
    .lb-next{right:16px}
  </style>
</head>
<body>

  <nav class="nav">
    <div class="nav-inner">
      <div class="brand">Юлия & Максим</div>
      <div class="links">
        <a href="#invite">Приглашение</a>
        <a href="#date">Дата</a>
        <a href="#place">Место</a>
        <a href="#schedule">Расписание</a>
        <a href="#dress">Дресс-код</a>
        <a href="#rsvp">RSVP</a>
      </div>
      <button class="burger" aria-label="Открыть меню" aria-controls="menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>

  <!-- Приветственный раздел -->
  <section class="hero" id="home">
    <div class="hero-bg" aria-hidden="true"></div>
    <div class="hero-overlay" aria-hidden="true"></div>
    <div class="hero-card">
      <h1>Юлия & Максим</h1>
      <p>С любовью приглашаем вас разделить с нами наш особенный день.</p>
      <a href="#invite" class="btn">Смотреть приглашение</a>
    </div>
  </section>

  <!-- Приглашение -->
  <section id="invite">
    <div class="card reveal">
      <h2>Приглашение</h2>
      <p>Дорогие родные и друзья, мы счастливы пригласить вас на нашу свадьбу. Пусть этот день станет началом новой истории, которую мы напишем вместе с вами — в атмосфере радости, тепла и вдохновения.</p>
    </div>
  </section>

  <!-- Дата проведения -->
  <section id="date">
    <div class="card alt reveal">
      <h2>Дата проведения</h2>
      <div class="calendar" aria-label="Календарь: июль 2026">
        <div class="cal-header">
          <div class="cal-title">Июль 2026</div>
        </div>
        <div class="cal-week" aria-hidden="true">
          <span>Пн</span><span>Вт</span><span>Ср</span><span>Чт</span><span>Пт</span><span>Сб</span><span>Вс</span>
        </div>
        <div class="cal-grid">
          <!-- Июль 2026 начинается в среду (1) и имеет 31 день -->
          <!-- неделя 1 -->
          <div class="day muted" aria-hidden="true"><span class="num">29</span></div>
          <div class="day muted" aria-hidden="true"><span class="num">30</span></div>
          <div class="day"><span class="num">1</span></div>
          <div class="day"><span class="num">2</span></div>
          <div class="day"><span class="num">3</span></div>
          <div class="day"><span class="num">4</span></div>
          <div class="day"><span class="num">5</span></div>
          <!-- неделя 2 -->
          <div class="day"><span class="num">6</span></div>
          <div class="day"><span class="num">7</span></div>
          <div class="day"><span class="num">8</span></div>
          <div class="day"><span class="num">9</span></div>
          <div class="day"><span class="num">10</span></div>
          <div class="day heart" aria-label="Выбранная дата: 11 июля 2026"><span class="num">11</span></div>
          <div class="day"><span class="num">12</span></div>
          <!-- неделя 3 -->
          <div class="day"><span class="num">13</span></div>
          <div class="day"><span class="num">14</span></div>
          <div class="day"><span class="num">15</span></div>
          <div class="day"><span class="num">16</span></div>
          <div class="day"><span class="num">17</span></div>
          <div class="day"><span class="num">18</span></div>
          <div class="day"><span class="num">19</span></div>
          <!-- неделя 4 -->
          <div class="day"><span class="num">20</span></div>
          <div class="day"><span class="num">21</span></div>
          <div class="day"><span class="num">22</span></div>
          <div class="day"><span class="num">23</span></div>
          <div class="day"><span class="num">24</span></div>
          <div class="day"><span class="num">25</span></div>
          <div class="day"><span class="num">26</span></div>
          <!-- неделя 5 -->
          <div class="day"><span class="num">27</span></div>
          <div class="day"><span class="num">28</span></div>
          <div class="day"><span class="num">29</span></div>
          <div class="day"><span class="num">30</span></div>
          <div class="day"><span class="num">31</span></div>
          <div class="day muted" aria-hidden="true"><span class="num">1</span></div>
          <div class="day muted" aria-hidden="true"><span class="num">2</span></div>
        </div>
      </div>
      <p class="note" style="text-align:center;margin-top:12px">Дату легко заметить — мы отметили её сердечком.</p>
    </div>
  </section>

  <!-- Место проведения и время -->
  <section id="place">
    <div class="card reveal grid">
      <div>
        <h2>Место и время</h2>
        <p><strong>Еда и Культура Catering</strong><br>Нижний Новгород</p>
        <p><span class="time">Сбор гостей в 16:00</span></p>
        <a class="btn" href="https://yandex.ru/profile/-/CLAfuHPb" target="_blank" rel="noopener">Открыть карту</a>
      </div>
      <div>
        <div class="slider" id="placeSlider" aria-label="Фотографии локации">
          <div class="slides">
            <div class="slide"><img src="./Place-1.jpg" alt="Еда и Культура — вид 1"></div>
            <div class="slide"><img src="./Place-2.jpg" alt="Еда и Культура — вид 2"></div>
            <div class="slide"><img src="./Place-3.jpg" alt="Еда и Культура — вид 3"></div>
          </div>
          <div class="dots" role="tablist" aria-label="Индикаторы слайдов">
            <button class="dot" aria-label="Слайд 1" aria-controls="placeSlider"></button>
            <button class="dot" aria-label="Слайд 2" aria-controls="placeSlider"></button>
            <button class="dot" aria-label="Слайд 3" aria-controls="placeSlider"></button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Расписание дня -->
  <section id="schedule">
    <div class="card alt reveal">
      <h2>Расписание дня</h2>
      <div class="timeline">
        <div class="item"><span class="dot"></span><div class="time">16:00</div><div>Сбор гостей, welcome‑фуршет</div></div>
        <div class="item"><span class="dot"></span><div class="time">16:30</div><div>Церемония</div></div>
        <div class="item"><span class="dot"></span><div class="time">17:00</div><div>Фотосессия со всеми гостями</div></div>
        <div class="item"><span class="dot"></span><div class="time">17:30</div><div>Банкет, торжественная часть</div></div>
        <div class="item"><span class="dot"></span><div class="time">21:00</div><div>Торт, вечеринка</div></div>
      </div>
    </div>
  </section>

  <!-- Дресс-код -->
  <section id="dress">
    <div class="card reveal">
      <h2>Дресс-код</h2>
      <div class="dress-block">
        <div class="subhead">Стиль</div>
        <p>Формальный / cocktail. Эстетика природных спокойных тонов.</p>
        <div class="dress-sep"></div>

        <div class="subhead">Палитра цветов</div>
        <div class="palette" aria-label="Рекомендуемая палитра">
          <span class="swatch" style="background:#e8efe7" title="Мягкий шалфей"></span>
          <span class="swatch" style="background:#b7cbbf" title="Серо-зелёный"></span>
          <span class="swatch" style="background:#6f8f80" title="Туманная хвоя"></span>
          <span class="swatch center" style="background:#2f5d50" title="Тёмный зелёный (база)"></span>
          <span class="swatch" style="background:#9aaea5" title="Шёлковый шалфей"></span>
          <span class="swatch" style="background:#d9c7a3" title="Тёплый песочный"></span>
          <span class="swatch" style="background:#c9a95c" title="Золотой акцент"></span>
        </div>
        <div class="dress-sep"></div>

        <div class="subhead">Запрещённые цвета</div>
        <div class="forbidden">
          <span class="swatch -forbidden" style="background:#ffffff" title="Белый — запрещён"></span>
          <span class="swatch -forbidden" style="background:#000000" title="Чёрный — запрещён"></span>
        </div>
        <p class="note">Белый и чёрный недопустимы: белый — для невесты, чёрный создаёт излишний контраст.</p>
      </div>
    </div>
  </section>

  <!-- RSVP -->
  <section id="rsvp">
    <div class="card alt reveal">
      <h2>Подтвердите участие</h2>
      <form id="rsvpForm">
        <label for="answer">Я приду</label>
        <select id="answer" name="answer" required>
          <option value="" disabled selected>Выберите вариант</option>
          <option value="yes">Приду один(а)</option>
          <option value="plus">Приду с парой (+1)</option>
          <option value="no">К сожалению, не смогу</option>
        </select>

        <label for="name">Имя и фамилия</label>
        <input id="name" name="name" type="text" placeholder="Иван Иванов" required>

        <button type="submit">Отправить ответ</button>
        <div class="note">Ваш ответ сохранится на этом устройстве.</div>
        <p id="submitError" style="display:none;margin-top:8px;color:#c44"></p>
      </form>
      <p id="thanks" style="display:none;margin-top:14px;color:var(--accent);font-weight:600"></p>
      <div id="postActions" style="display:none; margin-top:12px; display:flex; gap:10px; justify-content:center">
        <button id="btnEdit" type="button" style="background:#fff;color:var(--accent);border:1px solid var(--accent)">Изменить ответ</button>
        <button id="btnView" type="button">Кто идёт</button>
      </div>
    </div>
  </section>

  <footer>
    С любовью, Юлия & Максим
  </footer>

  <!-- Модальное окно списка участников -->
  <div id="guestsModal" class="modal" aria-hidden="true" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:2100">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="guestsTitle" style="background:#fff;max-width:720px;width:92vw;border-radius:12px;box-shadow:var(--shadow);position:relative;padding:20px 18px 16px;text-align:left">
      <button class="modal-close" aria-label="Закрыть" style="position:absolute;right:10px;top:10px;background:transparent;border:none;border-radius:0;cursor:pointer;font-size:24px;line-height:1;color:#555;padding:0;width:auto;margin:0">×</button>
      <h3 id="guestsTitle" style="font-family:'Cormorant Garamond',serif;color:var(--accent);font-size:1.6rem;margin-bottom:10px">Кто будет на свадьбе</h3>
      <div id="guestsLoading" class="note" style="margin-bottom:8px">Загружаем список…</div>
      <div style="overflow:auto;max-height:60vh;border:1px solid rgba(0,0,0,.06);border-radius:8px">
        <table style="width:100%;border-collapse:collapse">
          <thead>
            <tr style="background:rgba(201,169,92,.08)"><th style="text-align:left;padding:10px;border-bottom:1px solid rgba(0,0,0,.06)">Имя</th><th style="text-align:left;padding:10px;border-bottom:1px solid rgba(0,0,0,.06)">Ответ</th></tr>
          </thead>
          <tbody id="guestsBody"></tbody>
        </table>
      </div>
      <div id="guestsFooter" class="note" style="margin-top:10px"></div>
    </div>
  </div>

  <script>
    // Появление секций
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show') })
    },{threshold:.15});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    // Параллакс для фона героя
    const heroBg = document.querySelector('.hero-bg');
    window.addEventListener('scroll',()=>{
      const y = window.scrollY * 0.3;
      heroBg.style.transform = `translate3d(0, ${y}px, 0)`;
    },{passive:true});

    // Конфетти-лепестки
    const symbols = ['✿','❀','✾','❁'];
    function spawnConfetti(){
      const el = document.createElement('span');
      el.className = 'confetti';
      el.textContent = symbols[Math.floor(Math.random()*symbols.length)];
      el.style.left = Math.random()*100 + 'vw';
      el.style.animationDuration = (3 + Math.random()*3) + 's';
      document.body.appendChild(el);
      setTimeout(()=>el.remove(),6500);
    }
    let confettiTimer = setInterval(spawnConfetti,900);
    // слегка уменьшаем частоту при бездействии
    let idle;
    window.addEventListener('mousemove',()=>{clearTimeout(idle);confettiTimer ||= setInterval(spawnConfetti,900);idle=setTimeout(()=>{clearInterval(confettiTimer);confettiTimer=null},6000)});

    // RSVP сохранение
    const form = document.getElementById('rsvpForm');
    const thanks = document.getElementById('thanks');
    const postActions = document.getElementById('postActions');
    const btnEdit = document.getElementById('btnEdit');
    const btnView = document.getElementById('btnView');

    function renderSaved(){
      const saved = localStorage.getItem('rsvp_v1');
      if(saved){
        const data = JSON.parse(saved);
        form.style.display='none';
        thanks.style.display='block';
        const map = {yes:'придёте один(а)', plus:'придёте с парой', no:'не придёте'};
        thanks.textContent = `Спасибо, ${data.name}! Вы указали, что ${map[data.answer]}.`;
        if(postActions){ postActions.style.display = 'flex'; }
      } else {
        if(postActions){ postActions.style.display = 'none'; }
        thanks.style.display='none';
        form.style.display='block';
      }
    }
    renderSaved();

    form?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(form);
      const payload = {answer: fd.get('answer'), name: fd.get('name')};
      const submitBtn = form.querySelector('button[type="submit"]');
      const errEl = document.getElementById('submitError');
      errEl.style.display = 'none';
      errEl.textContent = '';

      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Отправляем...';
      try{
        const res = await fetch('/api/rsvp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        if(!res.ok){
          throw new Error('Сервер вернул ошибку ' + res.status);
        }
        // Сохраняем локально только при успешной отправке
        localStorage.setItem('rsvp_v1', JSON.stringify(payload));
        renderSaved();
      }catch(err){
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        errEl.textContent = 'Не удалось отправить. Попробуйте ещё раз позже.';
        errEl.style.display = 'block';
        return;
      }
    });

    // Редактирование сохранённого ответа
    btnEdit?.addEventListener('click', ()=>{
      const saved = localStorage.getItem('rsvp_v1');
      if(!saved) return;
      const data = JSON.parse(saved);
      // восстановление значений
      const answerEl = document.getElementById('answer');
      const nameEl = document.getElementById('name');
      if(answerEl) answerEl.value = data.answer || '';
      if(nameEl) nameEl.value = data.name || '';
      // показать форму снова
      thanks.style.display = 'none';
      if(postActions) postActions.style.display = 'none';
      form.style.display = 'block';
      // прокрутка к форме
      form.scrollIntoView({behavior:'smooth', block:'center'});
    });

    // Модалка списка гостей
    const modal = document.getElementById('guestsModal');
    const modalCloseBtn = modal?.querySelector('.modal-close');
    const modalBodyTbody = document.getElementById('guestsBody');
    const modalLoading = document.getElementById('guestsLoading');
    const modalFooter = document.getElementById('guestsFooter');

    function mapAnswerToText(answer){
      const map = {yes:'Придёт один(а)', plus:'Придёт с парой (+1)', no:'Не придёт'};
      return map[answer] || answer || '';
    }

    function computeSize(list){
      // Если сервер не прислал size — посчитаем: yes=1, plus=2, no=0
      let total = 0;
      list.forEach(item=>{
        if(item.answer === 'yes') total += 1;
        else if(item.answer === 'plus' || item.answer === 'plus1') total += 2;
      });
      return total;
    }

    function openModal(){
      if(!modal) return;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      if(!modal) return;
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }

    modalCloseBtn?.addEventListener('click', closeModal);
    modal?.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal?.style.display==='flex') closeModal(); });

    async function loadGuests(){
      if(!modalBodyTbody || !modalLoading || !modalFooter) return;
      modalLoading.style.display = 'block';
      modalBodyTbody.innerHTML = '';
      modalFooter.textContent = '';
      try{
        const res = await fetch('/api/rsvp/guests', { method:'GET', headers: { 'Accept': 'application/json' } });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const dto = await res.json();
        // Ожидаем GuestDto { list: RsvpDto[], size: number }
        const list = Array.isArray(dto?.guests) ? dto.guests : [];
        const size = (typeof dto?.size === 'number') ? dto.size : computeSize(list);
        if(list.length === 0){
          modalBodyTbody.innerHTML = '<tr><td style="padding:10px" colspan="2">Пока пусто</td></tr>';
        } else {
          const rows = list.map(item => `\n<tr><td style=\"padding:10px;border-bottom:1px solid rgba(0,0,0,.06)\">${(item.name||'')}</td><td style=\"padding:10px;border-bottom:1px solid rgba(0,0,0,.06)\">${mapAnswerToText(item.answer)}</td></tr>`).join('');
          modalBodyTbody.innerHTML = rows;
        }
        modalFooter.textContent = `Всего участников: ${size}`;
      } catch(err){
        modalBodyTbody.innerHTML = '<tr><td style="padding:10px" colspan="2">Не удалось загрузить список</td></tr>';
      } finally {
        modalLoading.style.display = 'none';
      }
    }

    btnView?.addEventListener('click', ()=>{ openModal(); loadGuests(); });

    // Мобильное меню
    const nav = document.querySelector('.nav');
    const burger = document.querySelector('.burger');
    const links = document.querySelectorAll('.links a');
    burger?.addEventListener('click', ()=>{
      const isOpen = nav.classList.toggle('open');
      burger.setAttribute('aria-expanded', String(isOpen));
    });
    links.forEach(a=>a.addEventListener('click', ()=>{
      if(nav.classList.contains('open')){
        nav.classList.remove('open');
        burger.setAttribute('aria-expanded','false');
      }
    }));
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && nav.classList.contains('open')){
        nav.classList.remove('open');
        burger.setAttribute('aria-expanded','false');
      }
    });
    // Слайдер места + лайтбокс
    (function(){
      const slider = document.getElementById('placeSlider');
      if(!slider) return;
      const track = slider.querySelector('.slides');
      const slides = Array.from(slider.querySelectorAll('.slide'));
      const dots = Array.from(slider.querySelectorAll('.dot'));
      let index = 0; let timer;
      function go(i){
        index = (i+slides.length)%slides.length;
        track.style.transform = `translateX(-${index*100}%)`;
        dots.forEach((d,j)=>d.classList.toggle('active', j===index));
      }
      function play(){ timer = setInterval(()=>go(index+1), 4000) }
      function stop(){ clearInterval(timer) }
      dots.forEach((d,i)=>d.addEventListener('click',()=>{stop();go(i);play()}));
      go(0); play();

      // Лайтбокс
      const lb = document.createElement('div');
      lb.className = 'lightbox';
      lb.innerHTML = `
        <button class="lb-close" aria-label="Закрыть">×</button>
        <button class="lb-arrow lb-prev" aria-label="Предыдущий">‹</button>
        <img alt="Просмотр изображения"/>
        <button class="lb-arrow lb-next" aria-label="Следующий">›</button>
      `;
      document.body.appendChild(lb);
      const lbImg = lb.querySelector('img');
      const close = ()=>{lb.classList.remove('open'); document.body.style.overflow='';}
      const open = (i)=>{index=i; lbImg.src = slides[index].querySelector('img').src; lb.classList.add('open'); document.body.style.overflow='hidden'}
      slides.forEach((s,i)=>s.addEventListener('click',()=>open(i)));
      lb.querySelector('.lb-close').addEventListener('click',close);
      lb.addEventListener('click',(e)=>{ if(e.target===lb) close() });
      lb.querySelector('.lb-prev').addEventListener('click',()=>{index=(index-1+slides.length)%slides.length; lbImg.src=slides[index].querySelector('img').src});
      lb.querySelector('.lb-next').addEventListener('click',()=>{index=(index+1)%slides.length; lbImg.src=slides[index].querySelector('img').src});
      window.addEventListener('keydown',(e)=>{ if(!lb.classList.contains('open')) return; if(e.key==='Escape') close(); if(e.key==='ArrowLeft') lb.querySelector('.lb-prev').click(); if(e.key==='ArrowRight') lb.querySelector('.lb-next').click(); });
    })();
  </script>
</body>
</html>


